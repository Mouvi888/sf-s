<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Short Linker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <style>
        .center {
            position: absolute;
            left: 50%;
            top: 50%;
            -webkit-transform: translate(-50%, -50%);
            transform: translate(-50%, -50%);
            width: 600px;
        }
        body {
            background-color: #171717;
        }
        h2, label, div {
            color: white;
        }
        input {
            background-color: #2D3748 !important;
            color: white !important;
        }
    </style>
</head>
<body>
<div class="center">
    <h2 style="text-align: center">Сократитель ссылок</h2>
    <div id="alerts"></div>
    <div class="mb-1">
        <label for="urlInput" class="form-label">URL:</label>
        <input type="url" class="form-control" id="urlInput" oninput="check(this)" autocomplete="off" maxlength="256" placeholder="https://example.com/">
    </div>
    <button type="button" class="btn btn-primary" id="shortUrl" disabled onclick="short()">Short</button>
    <div class="mt-3" id="shortenerUrlDiv" hidden>
        <label for="shortenerUrlInput">Shortener URL: </label><input type="url" class="form-control" readonly id="shortenerUrlInput">
    </div>
    <div class="text-center mt-2"></div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<script>
    let a = null

    function validURL(str) {
        let url;

        if (!/^https?:\/\//i.test(str)) {
            str = 'http://' + str;
        }

        try {
            url = new URL(str);
        } catch (_) {
            return false;
        }

        return url.protocol === "http:" || url.protocol === "https:";

        // old

        let pattern = new RegExp('^(https?:\\/\\/)?'+ // protocol
            '((([a-zа-я\\d]([a-zа-я\\d-]*[a-zа-я\\d])*)\\.)+[a-zа-я]{2,}|'+ // domain name
            '((\\d{1,3}\\.){3}\\d{1,3}))'+ // OR ip (v4) address
            '(\\:\\d+)?(\\/[-a-zа-я\\d%_.~+@]*)*'+ // port and path
            '(\\?[;&a-z\\d%_.~+=-]*)?'+ // query string
            '(\\#[-a-zа-я\\d_]*)?$','i'); // fragment locator
        return !!pattern.test(str);
    }

    function check(e){
        if(a != null)
            clearTimeout(a)
        a = setTimeout(() =>document.getElementById('shortUrl').disabled = !validURL(e.value), 300)
    }


    const alerts = document.getElementById('alerts')
    function showAlert(message, type) {

        let wrapper = document.createElement('div')
        wrapper.innerHTML = '<div class="alert alert-' + type + ' alert-dismissible" role="alert">' + message + '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>'

        alerts.append(wrapper)
    }


    function short(){
        let url = document.getElementById('urlInput').value
        if(!validURL(url))
            return
        if (!/^https?:\/\//i.test(url)) {
            url = 'http://' + url;
        }
        let formData = new FormData()
        formData.append('link', url)
        fetch('api/short.php', {method: 'post', body: formData}).then(async e => {
                if (!e.ok) {
                    showAlert('Server Error: ' + e.status, 'danger')
                } else {
                    document.getElementById('shortenerUrlDiv').hidden = false
                    document.getElementById('shortenerUrlInput').value = (await e.json()).url
                }
            }
        )
    }
<footer>
        &copy; 2024 Все права защищены 
<p style="font-size: 12px;">По поводу всех вопросов обращайте по эл. почте - <strong>help@mouvi.lol</strong></p>
    </footer>
</script>
</body>
</html>
